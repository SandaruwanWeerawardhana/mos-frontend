let items = [
  {
    itemCode: "B1001",
    itemName: "Classic Burger",
    price: 750.0,
    discount: 0,
    img: "https://images.pexels.com/photos/5554607/pexels-photo-5554607.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1003",
    itemName: "Turkey Burger",
    price: 1600.0,
    discount: 0,
    img: "https://images.pexels.com/photos/3738730/pexels-photo-3738730.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1004",
    itemName: "Chicken Burger",
    price: 1400.0,
    discount: 0,
    img: "https://images.pexels.com/photos/15832879/pexels-photo-15832879/free-photo-of-cheeseburger-with-french-fries-and-three-dipping-sauces.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1005",
    itemName: "Chicken Burger",
    price: 800.0,
    discount: 20,
    img: "https://images.pexels.com/photos/552056/pexels-photo-552056.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1006",
    itemName: "Cheese Burger",
    price: 1000.0,
    discount: 0,
    img: "https://images.pexels.com/photos/13163534/pexels-photo-13163534.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1007",
    itemName: "Cheese Burger",
    price: 600.0,
    discount: 0,
    img: "https://images.pexels.com/photos/580612/pexels-photo-580612.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1008",
    itemName: "Bacon Burger",
    price: 650.0,
    discount: 15,
    img: "https://images.pexels.com/photos/15146310/pexels-photo-15146310/free-photo-of-burgere-on-plate.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1009",
    itemName: "Shawarma Burger",
    price: 800.0,
    discount: 0,
    img: "https://images.pexels.com/photos/18188571/pexels-photo-18188571/free-photo-of-burger-and-a-shawarma.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1010",
    itemName: "Olive Burger",
    price: 1800.0,
    discount: 0,
    img: "https://images.pexels.com/photos/11401287/pexels-photo-11401287.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1012",
    itemName: "Cheese Burger",
    price: 1250.0,
    discount: 20,
    img: "https://images.pexels.com/photos/10922927/pexels-photo-10922927.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1013",
    itemName: "Crispy Burger",
    price: 1200.0,
    discount: 0,
    img: "https://images.pexels.com/photos/6896379/pexels-photo-6896379.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1014",
    itemName: "Chicken Burger",
    price: 1600.0,
    discount: 10,
    img: "https://images.pexels.com/photos/5474640/pexels-photo-5474640.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1015",
    itemName: "Paneer Burger",
    price: 900.0,
    discount: 0,
    img: "https://images.pexels.com/photos/1556688/pexels-photo-1556688.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1",
  },
  {
    itemCode: "B1044",
    itemName: "Pepsi",
    price: 990.0,
    discount: 5,
    img: "https://www.ocado.com/productImages/612/612029011_1_640x640.jpg?identifier=03aff14ac20f6f9db3749cf29dd865b7",
  },
  {
    itemCode: "B1045",
    itemName: "Coca-Cola",
    price: 1230.0,
    discount: 0,
    img: "https://i.pinimg.com/originals/99/af/9c/99af9cd03aaf6a856fdfea9d27802f24.jpg",
  },
  {
    itemCode: "B1046",
    itemName: "Sprite",
    price: 1500.0,
    discount: 3,
    img: "https://i.pinimg.com/736x/da/29/54/da29549b7fd367669b7d8502d9d0028c.jpg",
  },
  {
    itemCode: "B1047",
    itemName: "Mirinda",
    price: 850.0,
    discount: 7,
    img: "https://i.pinimg.com/736x/99/0b/46/990b466538fbdc1f4b6722a6a393e908.jpg",
  },
  {
    itemCode: "B1038",
    itemName: "Fried Chicken",
    price: 1200.0,
    discount: 0,
    img: "https://christieathome.com/wp-content/uploads/2020/10/Facetune_06-10-2020-15-37-58-scaled.jpg",
  },
  {
    itemCode: "B1039",
    itemName: "Fried Chicken",
    price: 2300.0,
    discount: 10,
    img: "https://www.therusticelk.com/wp-content/uploads/2018/09/Southern-fried-chicken-2.jpg",
  },
  {
    itemCode: "B1040",
    itemName: "Fried Chicken",
    price: 3100.0,
    discount: 5,
    img: "https://airfryermom.com/wp-content/uploads/2022/05/Cook-Fried-Chicken-in-Air-Fryer.jpg",
  },
  {
    itemCode: "B1041",
    itemName: "Hot Wings",
    price: 2400.0,
    discount: 0,
    img: "https://www.browneyedbaker.com/wp-content/uploads/2020/12/buttermilk-fried-chicken-12-square.jpg",
  },
  {
    itemCode: "B1042",
    itemName: "Devilled Chicken",
    price: 900.0,
    discount: 0,
    img: "https://foodserviceindia.com/wp-content/uploads/2023/07/Frame-65.jpg",
  },
  {
    itemCode: "B1043",
    itemName: "BBQ Chicken",
    price: 2100.0,
    discount: 0,
    img: "https://poshjournal.com/wp-content/uploads/2021/02/thai-bbq-chicken-wings-8.jpg",
  },
];

function loadTable() {
  fetch("http://localhost:8080/mos/order/get-all", {
    method: "GET",
    redirect: "follow",
  })
    .then((response) => response.json())
    .then((result) => {
      let tblBody = document.getElementById("PlacedTable");
      let body = "";


      result.forEach((element) => {
        body += `
          <tr>
            <td>${element.orderID}</td>
            <td>${element.cusID}</td>
            <td>${element.total}</td>
            <td>${element.date}</td>
            <td>
              <button class="btn btn-sm btn-primary" onclick="printBill(${
                element.orderID
              })">Print</button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteItem(${
                element.orderID
              })">üóëÔ∏è</button>
            </td>
          </tr>    
        `;
      });

      tblBody.innerHTML = body;
      console.log(result);
    })
    .catch((error) => console.log("Error fetching data:", error));
}
loadTable();

//  delete Customer
function deleteItem(index) {
  const requestOptions = {
    method: "DELETE",
    redirect: "follow",
  };

  fetch(`http://localhost:8080/mos/order/delete/${index}`, requestOptions)
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.text();
    })
    .then((result) => {
      console.log(result);
      loadTable();
    })
    .catch((error) => {
      console.error("Error deleting customer:", error);
    });
}

// print bill


function printBill(orderID) {
  fetch(`http://localhost:8080/mos/order/get-all-byID/${orderID}`, {
    method: "GET",
    redirect: "follow",
  })
    .then((response) => response.json())
    .then((order) => {
      console.log(order);
      
      const printContent = `
        <html>
          <head>
            <title>Bill - Order #${orderID}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; }
              .bill-header { text-align: center; margin-bottom: 20px; }
              .bill-details { margin-bottom: 15px; }
              .bill-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
              .bill-table th, .bill-table td { border: 1px solid #ddd; padding: 8px; }
              .text-right { text-align: right; }
              .total-row { font-weight: bold; }
              @media print {
                body { margin: 0; padding: 20px; }
                .no-print { display: none !important; }
              }
            </style>
          </head>
          <body>
            <div class="bill-header">
              <h2>Mos Burger Shop</h2>
              <p>324/01, Panadura, Colombo<br>Panadura, Sri Lanka</p>
            </div>

            <div class="bill-details">
              <p><strong>Order ID:</strong> #${orderID}</p>
              <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
            <table class="bill-table">
              <thead>
                <tr>
                  <th>Item ID</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>${order.itemID}</td>
                  <td>${order.qty}</td>
                  <td>Rs ${order.price}</td>
                  <td>Rs ${(order.qty * order.price)}</td>
                </tr>
                <tr class="total-row">
                  <td colspan="3" class="text-right">Subtotal:</td>
                  <td>Rs ${order.totPrice}</td>
                </tr>
                <tr class="total-row">
                  <td colspan="3" class="text-right">Discount (${order.discount}%):</td>
                  <td>Rs ${(order.totPrice * order.discount / 100)}</td>
                </tr>
                <tr class="total-row">
                  <td colspan="3" class="text-right">Grand Total:</td>
                  <td>Rs ${(order.totPrice - (order.totPrice * order.discount / 100))}</td>
                </tr>
              </tbody>
            </table>

            <div style="margin-top: 30px; text-align: center;">
              <p>Thank you for your business!</p>
              <button class="no-print" onclick="window.print()">Print Bill</button>
              <button class="no-print" onclick="window.close()">Close</button>
            </div>
          </body>
        </html>
      `;

      // Open print window
      const printWindow = window.open('', '_blank');
      printWindow.document.open();
      printWindow.document.write(printContent);
      printWindow.document.close();
      
      // Automatically trigger print dialog
      printWindow.focus();
      printWindow.print();
      printWindow.close();
    })
    .catch((error) => console.log("Error fetching order details:", error));
}
